<!DOCTYPE html>
<html>

<head>
    <link href="/favicon.png" rel="icon" type="image/png">
    <script defer src="//www.googletagservices.com/tag/js/gpt.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/6.4.0/video-js.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/6.4.0/video.js" type="text/javascript"></script>
    <!-- videojs-vast-vpaid -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs.vast.vpaid.min.css"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-vast-vpaid/2.0.2/videojs_5.vast.vpaid.min.js"></script>
    <script defer src="https://ebay.com/inte/automation/pubmatic_in_prebid_v1/prebid.js"></script>
    <meta charset="utf-8">
    <style>
        body {
            color: #555;
            font-family: sans-serif;
        }
    </style>

    <script>
        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];
        var PREBID_TIMEOUT = 3000;

        var date = new Date().getTime();

        pbjs.que.push(function () {
            var adUnits = [
                {
                    code: 'div-banner-video',
                    mediaTypes: {
                        video: {
                            context: 'instream',
                            playerSize: [640, 480]
                        },
                        banner: {
                            sizes: [[300, 250]]
                        }
                    },
                    bids: [{
                        bidder: 'pubmatic',
                        params: {
                            publisherId: '  164392  ',
                            adSlot: '/43743431/multiformatadunit1',
                            pmzoneid: 'zone1',
                            kadpageurl: 'www.yahoo.com?fixedbidnative=1&vb=21&bb=4&secure=1',

                            yob: '  1982  ',
                            gender: '   M   ',
                            kadfloor: '  1.75   ',
                            bidfloorcur: 'GBP',
                            video: {
                                mimes: ['video/mp4', 'video/x-flv'],
                                skippable: true,
                                minduration: 1,
                                maxduration: 30,
                                startdelay: 15,
                                playbackmethod: [1, 3],
                                api: [1, 2],
                                protocols: [2, 3],
                                w: 640,
                                h: 480,
                                battr: [13, 14],
                                linearity: 1,
                                placement: 2,
                                plcmt: 2,
                                minbitrate: 100,
                                maxbitrate: 4096
                            }
                        }
                    }]
                }
            ];
            pbjs.enableAnalytics({
                provider: 'pubmatic',
                options: {
                    publisherId: 164392,
                    profileId: 3596,
                    profileVersionId: 1
                }
            });

            pbjs.setConfig({
                device: {
                    ip: "10.172.141.12"
                },
                firstPartyData: {
                    uaHints: ['architecture', 'bitness', 'browsers', 'mobile', 'model', 'source']
                },

                debug: true,
                ortb2: {
                    device: {
                        ip: "10.172.141.12",
                        geo: {
                            lat: 40.712775,
                            lon: -74.005973,
                        }
                    }
                },
                userSync: {
                    topics: {
                        maxTopicCaller: 4,
                        bidders: [{
                            bidder: 'pubmatic',
                            iframeURL: 'https://ads.pubmatic.com/AdServer/js/topics/topics_frame.html'
                        }]
                    },
                    filterSettings: { iframe: { bidders: '*', filter: 'include' } },
                    enabledBidders: ['pubmatic'],
                    syncDelay: 3000,
                },
                'instreamTracking': {
                    enabled: true,
                },
                cache: {
                    url: 'https://prebid.adnxs.com/pbc/v1/cache'
                }
            });

            pbjs.addAdUnits(adUnits);
            pbjs.requestBids({
                bidsBackHandler: function (bidResponses) {
                    initAdserver();
                }
            });

            function initAdserver() {
                if (pbjs.initAdserverSet) return;

                var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
                    adUnit: adUnits[0],
                    params: {
                        //iu: '/15671365/PrebidVideoAdUnit_1705',
                        iu: '/43743431/multiformatadunit1',
                        cust_params: {
                            section: 'blog',
                            anotherKey: 'anotherValue'
                        },
                        output: 'vast'
                    }
                });

                googletag.cmd.push(function () {
                    pbjs.que.push(function () {
                        pbjs.setTargetingForGPTAsync();
                        googletag.pubads().refresh();
                    });
                });

                invokeVideoPlayer(videoUrl);
                pbjs.initAdserverSet = true;
            }

            setTimeout(initAdserver, PREBID_TIMEOUT);
        });




    </script>

    <script>
        googletag.cmd.push(function () {
            googletag
                .defineSlot(
                    '/43743431/multiformatadunit1', [
                    [728, 90],
                    [300, 250],
                    [160, 600]
                ],
                    'div-banner-video'
                )
                .addService(googletag.pubads());

            googletag.pubads().disableInitialLoad();
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });




    </script>
</head>

<body>
    <h2>Prebid Multi-Format Testing</h2>

    <h3>div-banner-video</h3>
    <div id='div-banner-video'>
        <p>No response</p>
        <script type='text/javascript'>
            googletag.cmd.push(function () {
                googletag.display('div-banner-video');
            });



        </script>
    </div>
    <video class="video-js vjs-default-skin vjs-big-play-centered" controls data-setup='{}' height='480' id="vid1"
        width='640'>
        <source src="http://vjs.zencdn.net/v/oceans.mp4" type='video/mp4' />
        <source src="http://vjs.zencdn.net/v/oceans.webm" type='video/webm' />
        <source src="http://vjs.zencdn.net/v/oceans.ogv" type='video/ogg' />
    </video>

    <script>
        var vid = videojs('vid1');
        function invokeVideoPlayer(url) {
            videojs("vid1").ready(function () {
                var player = this;
                var vastAd = player.vastClient({
                    adTagUrl: url,
                    playAdAlways: true,
                    verbosity: 4, adCancelTimeout: 10000,
                    vpaidFlashLoaderPath: "https://github.com/MailOnline/videojs-vast-vpaid/blob/RELEASE/bin/VPAIDFlash.swf?raw=true",
                    autoplay: true
                });
                player.muted(true);
                player.play();
                page_load_time = new Date().getTime() - performance.timing.navigationStart;
            });
        }



    </script>
</body>

</html>